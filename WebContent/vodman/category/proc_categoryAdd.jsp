<%@ page contentType="text/html; charset=euc-kr"%>
<%@ page import="java.sql.*, java.util.*, com.vodcaster.sqlbean.*,  com.hrlee.sqlbean.*, com.yundara.util.*,java.text.SimpleDateFormat,java.io.*"%>
<%@ include file = "/vodman/include/auth.jsp"%>
<%
if(!chk_auth(vod_id, vod_level, "cate_write")) {
    out.println("<script language='javascript'>\n" +
                "alert('회원레벨에 제한이 있습니다. 이전페이지로 이동합니다.');\n" +
                "history.go(-1);\n" +
                "</script>");
    return;
}
%>
<%
	/**
	 * @author 박종성
	 *
	 * @description : 카테고리정보 입력
	 * date : 2009-10-19
	 */
	 request.setCharacterEncoding("EUC-KR");

	String ctype = "";
	String mcode = request.getParameter("mcode");
	if(mcode == null || mcode.length() <= 0) {
		mcode = "0401";
	}
	
	if(request.getParameter("ctype") != null && request.getParameter("ctype").length()>0 && !request.getParameter("ctype").equals("null")){
		ctype = request.getParameter("ctype");
	}
	else {
		out.println("<SCRIPT LANGUAGE='JavaScript'>");
		out.println("alert('카테고리분류를 선택해주세요.')");
		//out.println("history.go(-1)");
		out.println("</SCRIPT>");
		String REF_URL="mng_categoryList.jsp?mcode="+mcode+"&ctype=V" ;
				%>
				<%@ include file = "/vodman/include/REF_URL.jsp"%>
				<%
				return;
	}
	
	

	CategoryManager mgr = CategoryManager.getInstance();
	int result = mgr.createCategory(request);

	if(result >= 0){
		/* 리눅스 버젼 적용
			BufferedReader bufferedReader = null;
			String Cmd = "chown -R voduser:voduser "+ com.vodcaster.sqlbean.DirectoryNameManager.UPLOAD_MEDIA;   // root 권한으로 폴더 생성 된것을 voduser 권한으로 변경

			try {
				Process process = Runtime.getRuntime().exec(Cmd);
				
				String line;        
				bufferedReader = new BufferedReader(new InputStreamReader(process.getInputStream()));
				bufferedReader.close();

				process.waitFor();
			} catch (Exception e) {
				System.out.println(e.toString());
			} finally {
				if (bufferedReader != null) try { bufferedReader.close(); } catch (Exception _ignored){}
			}
		*/
		//out.println("<script language='javascript'>location.href='mng_categoryList.jsp?mcode=0401&ctype=" +ctype+ "';</script>");
		out.println("<SCRIPT LANGUAGE='JavaScript'>");
		out.println("alert('등록되었습니다.')");
		out.println("</SCRIPT>");
		String REF_URL="mng_categoryList.jsp?mcode="+mcode+"&ctype="+ctype ;
				%>
				<%@ include file = "/vodman/include/REF_URL.jsp"%>
				<%
	}
	else{
		out.println("<SCRIPT LANGUAGE='JavaScript'>");
		out.println("alert('처리 중 오류가 발생했습니다. 잠시후에 다시 시도하여 주세요.')");
		//out.println("history.go(-1)");
		out.println("</SCRIPT>");
		String REF_URL="mng_categoryList.jsp?mcode="+mcode+"&ctype="+ctype ;
				%>
				<%@ include file = "/vodman/include/REF_URL.jsp"%>
				<%
	}

%>